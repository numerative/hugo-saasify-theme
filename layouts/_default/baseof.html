<!DOCTYPE html>
<html lang="{{ .Site.LanguageCode | default "en" }}" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#142341">
    <meta name="color-scheme" content="light">
    
    <!-- Google Tag Manager -->
    {{ partial "google-tag-manager" . }}

    <!-- Google Analytics -->
    {{ partial "google-analytics" . }}
    
    <!-- Title -->
    <title>{{ if .IsHome }}{{ .Site.Params.homeTitle }} | {{ .Site.Title }}{{ else }}{{ .Title }} | {{ .Site.Title }}{{ end }}</title>
    
    <!-- Meta Tags -->
    <meta name="description" content="{{ with .Description }}{{ . }}{{ else }}{{ with .Site.Params.description }}{{ . }}{{ end }}{{ end }}">
    <meta name="author" content="{{ .Site.Params.author | default .Site.Title }}">
    <meta name="robots" content="{{ with .Params.robots }}{{ . }}{{ else }}index, follow{{ end }}">
    
    <!-- Open Graph -->
    <meta property="og:title" content="{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }} | {{ .Site.Title }}{{ end }}">
    <meta property="og:description" content="{{ with .Description }}{{ . }}{{ else }}{{ with .Site.Params.description }}{{ . }}{{ end }}{{ end }}">
    <meta property="og:type" content="{{ if .IsHome }}website{{ else }}article{{ end }}">
    <meta property="og:url" content="{{ .Permalink }}">
    <meta property="og:site_name" content="{{ .Site.Title }}">
    {{ with .Params.image }}
    <meta property="og:image" content="{{ . | absURL }}">
    {{ else }}
    {{ with .Site.Params.image }}
    <meta property="og:image" content="{{ . | absURL }}">
    {{ end }}
    {{ end }}
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }} | {{ .Site.Title }}{{ end }}">
    <meta name="twitter:description" content="{{ with .Description }}{{ . }}{{ else }}{{ with .Site.Params.description }}{{ . }}{{ end }}{{ end }}">
    {{ with .Site.Params.twitter }}
    <meta name="twitter:site" content="@{{ . }}">
    {{ end }}
    {{ with .Params.image }}
    <meta name="twitter:image" content="{{ . | absURL }}">
    {{ else }}
    {{ with .Site.Params.image }}
    <meta property="twitter:image" content="{{ . | absURL }}">
    {{ end }}
    {{ end }}
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{{ "images/favicon.ico" | relURL }}">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="{{ .Permalink }}">
    
    <!-- Preload LCP image for homepage hero background -->
    {{ if .IsHome }}
        {{ $content := .Content }}
        {{ if (findRE `background_image="([^"]+)"` $content) }}
            {{ $bgImage := index (findRE `background_image="([^"]+)"` $content) 0 }}
            {{ $bgImagePath := replaceRE `background_image="([^"]+)"` "$1" $bgImage }}
            <link rel="preload" href="{{ $bgImagePath | relURL }}" as="image" fetchpriority="high">
        {{ end }}
    {{ end }}
    
    <!-- Fonts - Break critical request chain by preloading font files directly -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://unpkg.com">
    
    <!-- Let Google Fonts CSS handle font loading - more reliable than hardcoded URLs -->
    
    <!-- Load font CSS asynchronously -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Plus+Jakarta+Sans:wght@600;700;800&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Plus+Jakarta+Sans:wght@600;700;800&display=swap" rel="stylesheet"></noscript>
    
    <!-- AOS CSS - Completely defer loading -->
    <!-- Modern CSS-only scroll animations - no JavaScript library needed -->
    <style>
        /* Base styles for scroll animations */
        [data-aos] {
            opacity: 0;
            transition: opacity 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94),
                       transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        
        /* Animation variants */
        [data-aos="fade-up"] { transform: translateY(30px); }
        [data-aos="fade-right"] { transform: translateX(-30px); }
        [data-aos="zoom-in"] { transform: scale(0.9); }
        
        /* Animated state */
        [data-aos].aos-animate {
            opacity: 1;
            transform: translateY(0) translateX(0) scale(1);
        }
        
        /* Even faster animations on mobile */
        @media (max-width: 768px) {
            [data-aos] {
                transition-duration: 0.2s;
            }
        }
        
        /* Respect user preferences */
        @media (prefers-reduced-motion: reduce) {
            [data-aos] {
                opacity: 1;
                transform: none;
                transition: none;
            }
        }
    </style>

    <!-- Main CSS -->
    {{ $css := resources.Get "css/main.css" }}
    {{ $css = $css | css.PostCSS }}
    {{ if hugo.IsProduction }}
        {{ $css = $css | minify | fingerprint | resources.PostProcess }}
    {{ end }}
    <link rel="stylesheet" href="{{ $css.RelPermalink }}">

    <!-- Additional Meta Tags from Front Matter -->
    {{ with .Params.customMeta }}
        {{ range . }}
        <meta {{ range $key, $value := . }} {{ $key }}="{{ $value }}"{{ end }}>
        {{ end }}
    {{ end }}

    <!-- Structured Data for Organization -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Organization",
        "@id": "{{ .Site.BaseURL }}#organization",
        "name": "{{ .Site.Title }}",
        "url": "{{ .Site.BaseURL }}",
        "description": "{{ .Site.Params.description }}",
        "slogan": "Empowering Global Trade"{{ with .Site.Params.logo }},
        "logo": {
            "@type": "ImageObject",
            "url": "{{ . | absURL }}",
            "width": "200",
            "height": "60"
        }{{ end }},
        "sameAs": [
            {{- $socialUrls := slice -}}
            {{- with .Site.Params.social.facebook -}}
                {{- $socialUrls = $socialUrls | append . -}}
            {{- end -}}
            {{- with .Site.Params.social.youtube -}}
                {{- $socialUrls = $socialUrls | append . -}}
            {{- end -}}
            {{- with .Site.Params.social.instagram -}}
                {{- $socialUrls = $socialUrls | append . -}}
            {{- end -}}
            {{- with .Site.Params.social.linkedin -}}
                {{- $socialUrls = $socialUrls | append . -}}
            {{- end -}}
            {{- with .Site.Params.social.twitter -}}
                {{- $socialUrls = $socialUrls | append . -}}
            {{- end -}}
            {{- range $index, $url := $socialUrls -}}
                {{- if $index -}},{{- end -}}
                "{{ $url }}"
            {{- end -}}
        ],
        "contactPoint": {
            "@type": "ContactPoint",
            "contactType": "customer service",
            {{- with .Site.Params.contact.phone -}}
            "telephone": "{{ . }}",
            {{- end -}}
            {{- with .Site.Params.contact.email -}}
            "email": "{{ . }}"
            {{- end -}}
        },
        "areaServed": {
            "@type": "City",
            "name": "Rajkot"
        }
    }
    </script>

    <!-- Structured Data for Website with Sitelinks -->
    {{ if .IsHome }}
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "@id": "{{ .Site.BaseURL }}#website",
        "name": "{{ .Site.Title }}",
        "alternateName": "{{ .Site.Params.homeTitle }}",
        "url": "{{ .Site.BaseURL }}",
        "description": "{{ .Site.Params.description }}",
        "publisher": {
            "@id": "{{ .Site.BaseURL }}#organization"
        },
        "inLanguage": ["en", "hi", "gu"]
    }
    </script>

    <!-- Structured Data for Site Navigation -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "ItemList",
        "@id": "{{ .Site.BaseURL }}#main-navigation",
        "name": "Site Navigation Menu",
        "numberOfItems": 4,
        "itemListElement": [
            {{- $aboutPage := .Site.GetPage "/about" -}}
            {
                "@type": "ListItem",
                "position": 1,
                "name": "About Us",
                {{- with $aboutPage.Description -}}
                "description": "{{ . }}",
                {{- end -}}
                "url": "{{ .Site.BaseURL }}about/"
            },
            {{- $servicesPage := .Site.GetPage "/services" -}}
            {
                "@type": "ListItem",
                "position": 2,
                "name": "Services",
                {{- with $servicesPage.Description -}}
                "description": "{{ . }}",
                {{- end -}}
                "url": "{{ .Site.BaseURL }}services/"
            },
            {{- $contactPage := .Site.GetPage "/contact" -}}
            {
                "@type": "ListItem",
                "position": 3,
                "name": "Contact",
                {{- with $contactPage.Description -}}
                "description": "{{ . }}",
                {{- end -}}
                "url": "{{ .Site.BaseURL }}contact/"
            },
            {
                "@type": "ListItem",
                "position": 4,
                {{- with .Site.Params.blog.title -}}
                "name": "{{ . }}",
                {{- else -}}
                "name": "Blog",
                {{- end -}}
                {{- with .Site.Params.blog.subtitle -}}
                "description": "{{ . }}",
                {{- end -}}
                "url": "{{ .Site.BaseURL }}blog/"
            }
        ]
    }
    </script>
    {{ end }}
</head>
<body class="min-h-screen flex flex-col light">
    <!-- Google Tag Manager (noscript) -->
    {{ if and hugo.IsProduction .Site.Params.googleTagManager }}
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id={{ .Site.Params.googleTagManager }}"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    {{ end }}
    <!-- End Google Tag Manager (noscript) -->
    <!-- Header -->
    <div class="fixed top-0 left-0 right-0 z-50">
        {{ partial "header" . }}
    </div>

    <!-- Main Content -->
    <div class="pt-20">
        {{ block "main" . }}{{ end }}
    </div>

    <!-- Footer -->
    {{ partial "footer" . }}

    <!-- Video Popup Modal -->
    {{ partial "components/video-popup.html" . }}

    <!-- Modern ES6+ Scroll Animations - No transpiling needed -->
    <script>
        class ModernScrollAnimations {
            constructor() {
                // Skip if user prefers reduced motion
                if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;
                
                this.elements = document.querySelectorAll('[data-aos]');
                this.observer = null;
                this.init();
            }

            init() {
                if (this.elements.length === 0) return;

                const options = {
                    threshold: 0,
                    rootMargin: '0px 0px 100px 0px'
                };

                this.observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const delay = entry.target.dataset.aosDelay || 0;
                            
                            setTimeout(() => {
                                entry.target.classList.add('aos-animate');
                            }, parseInt(delay));
                            
                            // Once animated, stop observing (once: true behavior)  
                            this.observer.unobserve(entry.target);
                        }
                    });
                }, options);

                this.elements.forEach(element => {
                    this.observer.observe(element);
                });
            }
        }

        // Initialize when DOM is ready - modern, non-blocking
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => new ModernScrollAnimations());
        } else {
            new ModernScrollAnimations();
        }
    </script>

    <!-- Mobile Menu Script -->
    <script>
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        if (mobileMenuButton) {
            mobileMenuButton.addEventListener('click', function() {
                const mobileMenu = document.getElementById('mobile-menu');
                if (mobileMenu) {
                    mobileMenu.classList.toggle('hidden');
                }
            });
        }
    </script>
</body>
</html>
